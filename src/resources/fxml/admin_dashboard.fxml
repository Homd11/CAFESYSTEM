<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane style="-fx-background-color: linear-gradient(from 0% 0% to 0% 100%, #f9fafc 0%, #eef2f7 100%);" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="GUI.AdminDashboardController">
   <top>
      <!-- Admin Navigation Bar -->
      <HBox alignment="CENTER_LEFT" spacing="20.0" style="-fx-background-color: linear-gradient(from 0% 0% to 100% 0%, #8B0000, #b33939);" styleClass="top-bar">
         <children>
            <Label fx:id="adminWelcomeLabel" text="ðŸ‘¤ Admin Dashboard">
               <font>
                  <Font name="Arial Bold" size="18.0" />
               </font>
            </Label>
            <Region HBox.hgrow="ALWAYS" />
            <Button fx:id="generateReportButton" onAction="#handleGenerateReport" styleClass="button primary" text="ðŸ“Š Generate Report" />
            <Button fx:id="adminLogoutButton" onAction="#handleLogout" styleClass="button danger" text="ðŸšª Logout" />
         </children>
      </HBox>
   </top>
   <center>
      <TabPane fx:id="adminTabPane" tabClosingPolicy="UNAVAILABLE">
         <tabs>
            <!-- Menu Management Tab -->
            <Tab text="ðŸ½ï¸ Menu Management">
               <content>
                  <VBox spacing="15.0">
                     <padding>
                        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                     </padding>
                     <children>
                        <Label styleClass="heading" text="Menu Items Management" />

                        <!-- Add New Item Section -->
                        <VBox spacing="10.0" styleClass="card">
                           <children>
                              <Label text="âž• Add New Menu Item">
                                 <font>
                                    <Font name="Arial Bold" size="16.0" />
                                 </font>
                              </Label>
                              <GridPane hgap="10.0" vgap="10.0">
                                 <columnConstraints>
                                    <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
                                    <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
                                    <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
                                 </columnConstraints>
                                 <children>
                                    <Label text="Name:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                    <TextField fx:id="itemNameField" GridPane.columnIndex="0" GridPane.rowIndex="1" />

                                    <Label text="Price:" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                                    <TextField fx:id="itemPriceField" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                                    <Label text="Category:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                    <ComboBox fx:id="itemCategoryCombo" prefWidth="150.0" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                                 </children>
                                 <rowConstraints>
                                    <RowConstraints />
                                    <RowConstraints />
                                 </rowConstraints>
                              </GridPane>
                              <HBox alignment="CENTER_LEFT" spacing="10.0">
                                 <children>
                                    <Button fx:id="addItemButton" onAction="#handleAddMenuItem" styleClass="button primary" text="âž• Add Item" />
                                    <Button fx:id="updateItemButton" onAction="#handleUpdateMenuItem" styleClass="button" text="âœï¸ Update Selected" />
                                    <Button fx:id="deleteItemButton" onAction="#handleDeleteMenuItem" styleClass="button danger" text="ðŸ—‘ï¸ Delete Selected" />
                                 </children>
                              </HBox>
                           </children>
                        </VBox>

                        <!-- Menu Items Table -->
                        <TableView fx:id="menuItemsTable" prefHeight="400.0" VBox.vgrow="ALWAYS">
                           <columns>
                              <TableColumn fx:id="menuIdColumn" prefWidth="80.0" text="ID" />
                              <TableColumn fx:id="menuNameColumn" prefWidth="200.0" text="Name" />
                              <TableColumn fx:id="menuPriceColumn" prefWidth="100.0" text="Price" />
                              <TableColumn fx:id="menuCategoryColumn" prefWidth="150.0" text="Category" />
                              <TableColumn fx:id="menuAvailableColumn" prefWidth="100.0" text="Available" />
                           </columns>
                        </TableView>
                     </children>
                  </VBox>
               </content>
            </Tab>

            <!-- Order Management Tab -->
            <Tab text="ðŸ“‹ Order Management">
               <content>
                  <VBox spacing="15.0">
                     <padding>
                        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                     </padding>
                     <children>
                        <Label styleClass="heading" text="Orders Management" />

                        <!-- Order Filters -->
                        <HBox alignment="CENTER_LEFT" spacing="15.0">
                           <children>
                              <Label text="Filter by Status:" />
                              <ComboBox fx:id="orderStatusFilter" onAction="#handleOrderStatusFilter" prefWidth="150.0" />
                              <Button fx:id="refreshOrdersButton" onAction="#handleRefreshOrders" styleClass="button primary" text="ðŸ”„ Refresh" />
                           </children>
                        </HBox>

                        <!-- Orders Table -->
                        <TableView fx:id="ordersTable" prefHeight="300.0" VBox.vgrow="ALWAYS">
                           <columns>
                              <TableColumn fx:id="orderIdColAdmin" prefWidth="80.0" text="Order ID" />
                              <TableColumn fx:id="studentNameColumn" prefWidth="150.0" text="Student" />
                              <TableColumn fx:id="orderDateColAdmin" prefWidth="150.0" text="Date" />
                              <TableColumn fx:id="orderItemsColAdmin" prefWidth="200.0" text="Items" />
                              <TableColumn fx:id="orderTotalColAdmin" prefWidth="100.0" text="Total" />
                              <TableColumn fx:id="orderStatusColAdmin" prefWidth="100.0" text="Status" />
                           </columns>
                        </TableView>

                        <!-- Order Actions -->
                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                           <children>
                              <Button fx:id="markPreparedButton" onAction="#handleMarkPrepared" styleClass="button primary" text="ðŸ³ Mark Preparing" />
                              <Button fx:id="markDeliveredButton" onAction="#handleMarkDelivered" styleClass="button success" text="âœ… Mark Ready" />
                              <Button fx:id="cancelOrderButton" onAction="#handleCancelOrder" styleClass="button danger" text="âŒ Reset Order" />
                           </children>
                        </HBox>
                     </children>
                  </VBox>
               </content>
            </Tab>

            <!-- Student Management Tab -->
            <Tab text="ðŸ‘¥ Student Management">
               <content>
                  <VBox spacing="15.0">
                     <padding>
                        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                     </padding>
                     <children>
                        <Label styleClass="heading" text="Students Management" />

                        <!-- Students Table -->
                        <TableView fx:id="studentsTable" prefHeight="400.0" VBox.vgrow="ALWAYS">
                           <columns>
                              <TableColumn fx:id="studentIdColumn" prefWidth="80.0" text="ID" />
                              <TableColumn fx:id="studentNameColAdmin" prefWidth="200.0" text="Name" />
                              <TableColumn fx:id="studentLoyaltyColumn" prefWidth="120.0" text="Loyalty Points" />
                              <TableColumn fx:id="studentOrdersColumn" prefWidth="100.0" text="Orders Count" />
                              <TableColumn fx:id="studentSpentColumn" prefWidth="120.0" text="Total Spent" />
                           </columns>
                        </TableView>

                        <!-- Student Actions -->
                        <HBox alignment="CENTER_LEFT" spacing="10.0">
                           <children>
                              <Button fx:id="viewStudentDetailsButton" onAction="#handleViewStudentDetails" styleClass="button" text="ðŸ‘ï¸ View Details" />
                              <Button fx:id="addLoyaltyPointsButton" onAction="#handleAddLoyaltyPoints" styleClass="button success" text="ðŸŽ Add Points" />
                           </children>
                        </HBox>
                     </children>
                  </VBox>
               </content>
            </Tab>

            <!-- Reports Tab -->
            <Tab text="ðŸ“Š Reports">
               <content>
                  <VBox spacing="20.0">
                     <padding>
                        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                     </padding>
                     <children>
                        <Label styleClass="heading" text="System Reports" />

                        <!-- Daily Reports -->
                        <VBox spacing="10.0" styleClass="card-info">
                           <children>
                              <Label text="ðŸ“ˆ Daily Statistics">
                                 <font>
                                    <Font name="Arial Bold" size="16.0" />
                                 </font>
                              </Label>
                              <Label fx:id="dailyOrdersLabel" text="Today's Orders: 0" />
                              <Label fx:id="dailySalesLabel" text="Today's Sales: 0.00 EGP" />
                              <Button fx:id="exportDailyButton" styleClass="button primary" text="ðŸ“¤ Export Daily Report" />
                           </children>
                        </VBox>

                        <!-- Popular Items -->
                        <VBox spacing="10.0" styleClass="card-success">
                           <children>
                              <Label text="ðŸ† Popular Items">
                                 <font>
                                    <Font name="Arial Bold" size="16.0" />
                                 </font>
                              </Label>
                              <ListView fx:id="popularItemsList" prefHeight="100.0" />
                              <Button fx:id="exportPopularButton" styleClass="button primary" text="ðŸ“¤ Export Popular Items" />
                           </children>
                        </VBox>

                        <!-- Student Statistics -->
                        <VBox spacing="10.0" styleClass="card-warning">
                           <children>
                              <Label text="ðŸ‘¥ Student Statistics">
                                 <font>
                                    <Font name="Arial Bold" size="16.0" />
                                 </font>
                              </Label>
                              <Label fx:id="totalStudentsLabel" text="Total Students: 0" />
                              <Label fx:id="activeStudentsLabel" text="Active Students: 0" />
                              <Button fx:id="exportStudentsButton" styleClass="button primary" text="ðŸ“¤ Export Student Report" />
                           </children>
                        </VBox>

                        <!-- Revenue Statistics -->
                        <VBox spacing="10.0" styleClass="card-purple">
                           <children>
                              <Label text="ðŸ’° Revenue Statistics">
                                 <font>
                                    <Font name="Arial Bold" size="16.0" />
                                 </font>
                              </Label>
                              <Label fx:id="monthlyRevenueLabel" text="Monthly Revenue: 0.00 EGP" />
                              <Label fx:id="totalRevenueLabel" text="Total Revenue: 0.00 EGP" />
                              <Button fx:id="exportRevenueButton" styleClass="button primary" text="ðŸ“¤ Export Revenue Report" />
                           </children>
                        </VBox>
                     </children>
                  </VBox>
               </content>
            </Tab>
         </tabs>
      </TabPane>
   </center>
</BorderPane>
